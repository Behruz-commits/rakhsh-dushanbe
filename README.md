# rakhsh — Умные светофоры Душанбе

## Цель проекта

Создать адаптивную цифровую систему управления городским движением в Душанбе с возможностью масштабирования на всю транспортную сеть.  

**Пилотная версия** демонстрирует работу ЦУАК и локальных контроллеров через **симуляцию потоков машин и пешеходов**, а также **веб-визуализацию состояния светофоров**.  

Проект подготовлен для дальнейшей интеграции с реальным оборудованием: контроллерами, датчиками и MQTT-сетями.

---

## Архитектура проекта

rakhsh-dushanbe/
├── hardware_interface/ # драйверы и интерфейсы железа
│ ├── traffic_light_driver.py
│ └── sensor_interface.py
├── communication/ # сетевые протоколы, MQTT
│ ├── mqtt_client.py
│ └── comm_utils.py
├── core/ # логика управления
│ ├── ai_optimizer.py
│ ├── decision_engine.py
│ └── data_processor.py
├── simulator/ # тестовая симуляция перекрестков
│ ├── traffic_simulator.py
│ ├── pedestrian_simulator.py
│ └── dummy_sensor_feed.py
├── ui/ # веб-интерфейс
│ ├── web_server.py
│ └── templates/
│ └── index.html
├── config/ # конфигурации
│ ├── controllers.yml
│ ├── network.yml
│ └── ai_params.yml
├── docs/ # документация проекта
└── run.sh # запуск системы

markdown
Копировать код

---

### 1. Локальные контроллеры (`hardware_interface/`)

- `traffic_light_driver.py` — управление состояниями светофора (RED → GREEN → YELLOW → RED).  
- `sensor_interface.py` — интерфейс для работы с реальными датчиками движения и пешеходов.  
- **Реализован режим симуляции** для тестирования без железа.  

### 2. Центральный узел (`core/`)

- `ai_optimizer.py` — принятие решений и адаптация длительности фаз светофора под реальный поток машин и пешеходов.  
- `decision_engine.py` — алгоритмы управления светофорами.  
- `data_processor.py` — обработка входящих данных с сенсоров и MQTT.  

### 3. Симулятор перекрестков (`simulator/`)

- `traffic_simulator.py` и `pedestrian_simulator.py` — генерация потоков машин и пешеходов.  
- `dummy_sensor_feed.py` — подача данных для тестирования без реальных датчиков.  

### 4. Веб-интерфейс (`ui/`)

- `web_server.py` — Flask-сервер с динамическим дашбордом.  
- `templates/index.html` — отображение состояния светофоров и потоков в реальном времени.  
- Данные обновляются через **MQTT → сервер → API `/api/state` → DOM**.  

### 5. Конфигурации (`config/`)

- `controllers.yml` — список контроллеров и перекрестков.  
- `network.yml` — параметры связи, топики MQTT.  
- `ai_params.yml` — пороги и параметры AI для адаптивного регулирования.  

---

## Работа демоверсии

- Все модули можно запускать **в режиме симуляции** или с реальным оборудованием.  
- **AIOptimizer** публикует состояния в MQTT, веб-сервер подписан и обновляет дашборд.  
- Локальные контроллеры симулируют циклы светофоров, или управляют реальным железом через `traffic_light_driver.py`.  
- Визуализация в вебе показывает **состояния перекрестков и динамику движения**.  

---

## Запуск пилота

1. Установите Python 3.11+.  
2. Установите зависимости:

```bash
pip install opencv-python numpy flask paho-mqtt
Запустите брокер MQTT (например, Mosquitto):

bash
Копировать код
mosquitto -v
Запустите веб-сервер:

bash
Копировать код
python ui/web_server.py
Запустите оптимизатор:

bash
Копировать код
python core/ai_optimizer.py
Откройте браузер: http://127.0.0.1:5000/ для наблюдения состояния перекрестков.
